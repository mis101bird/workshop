
<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
</head>
    <body>
    	[{"id":"2a98458f.dc50ca","type":"subflow","name":"百度翻譯","info":"","in":[{"x":276,"y":294.00000762939453,"wires":[{"id":"eb75bfb4.7bc97"}]}],"out":[{"x":1154.0000610351562,"y":332.00000762939453,"wires":[{"id":"6d62757.7bb3f8c","port":0}]}]},{"id":"5041728a.a05c6c","type":"function","z":"2a98458f.dc50ca","name":"","func":"var md5 = context.global.md5;\n\n\n//msg.payload='我 会 吃饭 打电动  看影片'\nvar ut=encodeURI(msg.payload);\n//appid+q+salt+密钥\nvar sign_word='20160512000020797'+msg.payload+'1435660288'+'PjAuPfz5BfOfrjjGjcZH';\n\nvar sign=md5(sign_word)\nmsg.url='http://api.fanyi.baidu.com/api/trans/vip/translate?q='+msg.payload+'&from=zh&to=cht&appid=20160512000020797&salt=1435660288&sign='+sign\n/*msg={\n    \n    q:msg.payload,\n    sign:sign,\n    from:'zh',\n    to:'cht',\n    appid:20160512000020797,\n    salt:1435660288\n    \n    \n    \n}*/\nreturn msg;","outputs":1,"noerr":0,"x":381.7418670654297,"y":642.9347381591797,"wires":[["ff9f873f.d1da48"]]},{"id":"86946bb0.60f3a8","type":"debug","z":"2a98458f.dc50ca","name":"","active":true,"console":"false","complete":"payload","x":1002.7363128662109,"y":951.5619201660156,"wires":[]},{"id":"ff9f873f.d1da48","type":"http request","z":"2a98458f.dc50ca","name":"","method":"GET","ret":"txt","url":"","x":612.7436370849609,"y":672.8558959960938,"wires":[["86946bb0.60f3a8","9ee1c90f.b2eff8"]]},{"id":"9ee1c90f.b2eff8","type":"json","z":"2a98458f.dc50ca","name":"","x":805.7388763427734,"y":665.6120910644531,"wires":[["b9122d8c.324ec","95e403b2.680f3"]]},{"id":"b9122d8c.324ec","type":"debug","z":"2a98458f.dc50ca","name":"","active":true,"console":"false","complete":"false","x":931.7568206787109,"y":824.8102722167969,"wires":[]},{"id":"95e403b2.680f3","type":"function","z":"2a98458f.dc50ca","name":"","func":"msg.payload=msg.payload.trans_result[0].dst\nreturn msg;","outputs":1,"noerr":0,"x":943.7375946044922,"y":674.0749053955078,"wires":[["9f51fa54.28b768"]]},{"id":"9f51fa54.28b768","type":"debug","z":"2a98458f.dc50ca","name":"","active":true,"console":"false","complete":"false","x":1118.7349090576172,"y":792.8198547363281,"wires":[]},{"id":"eb75bfb4.7bc97","type":"function","z":"2a98458f.dc50ca","name":"","func":"//msg.url='http://tommywu-iot-desinger.mybluemix.net/trans?text='+msg.payload;\nqStr=encodeURI(msg.payload);\nmsg.url='http://tommywu-iot-desinger.mybluemix.net/trans?text='+qStr;//%E4%BD%A0%E5%A5%BD%E7%8E%87'\nreturn msg;","outputs":1,"noerr":0,"x":632.8958129882812,"y":329.8888854980469,"wires":[["6d62757.7bb3f8c"]]},{"id":"6d62757.7bb3f8c","type":"http request","z":"2a98458f.dc50ca","name":"","method":"GET","ret":"txt","url":"","x":802.9652099609375,"y":330.2291564941406,"wires":[[]]},{"id":"2a29a4fc.b9ba2c","type":"function","z":"dbff05bd.4b4958","name":"","func":"msg.payload=msg.payload.d.text;\nreturn msg;","outputs":1,"noerr":0,"x":240,"y":460,"wires":[["244b1eba.227f72"]]},{"id":"99a1113a.bd055","type":"ibmiot in","z":"dbff05bd.4b4958","authentication":"boundService","apiKey":"","inputType":"evt","deviceId":"Sherry","applicationId":"","deviceType":"robot","eventType":"text","commandType":"","format":"json","name":"IBM IoT","service":"registered","allDevices":false,"allApplications":"","allDeviceTypes":"","allEvents":false,"allCommands":"","allFormats":"","x":97,"y":428,"wires":[["2a29a4fc.b9ba2c"]]},{"id":"244b1eba.227f72","type":"subflow:2a98458f.dc50ca","z":"dbff05bd.4b4958","name":"","x":268,"y":557,"wires":[["fdce3292.fffa4","d847c26b.af3a8"]]},{"id":"fdce3292.fffa4","type":"function","z":"dbff05bd.4b4958","name":"","func":"msg.dialog_params = {};\nif(msg.payload.indexOf('小妹') > -1 ){\ncontext.global.http_dialog_id='5baf5625-5acc-4a60-ba98-64bbc917dec9';\nmsg.dialog_params[\"dialog_id\"]='5baf5625-5acc-4a60-ba98-64bbc917dec9';\nreturn msg;\n}else if(msg.payload.indexOf('再見') > -1 ){\ncontext.global.phone_dialog_switch=false;\n}","outputs":1,"noerr":0,"x":438.5,"y":556,"wires":[["bd65858d.3a0778","c7ea8d98.aa09"]]},{"id":"d847c26b.af3a8","type":"function","z":"dbff05bd.4b4958","name":"","func":"var string=msg.payload.toString();\nvar blank_input=[];\n\n\nfor(var i=0;i<string.length;i++)\n{\n   blank_input[i*2]=string[i];\n   blank_input[i*2+1]=\" \";\n}\n\n//msg.payload=blank_input.toString()+\"VS \"+string;\nvar myString = blank_input.join('');\nmsg.payload=myString.trim();\nmsg.dialog_params = {};\nmsg.dialog_params[\"converse_id\"]=context.global.http_conversation_id;\nmsg.dialog_params[\"client_id\"]=context.global.http_client_id;\nreturn msg;","outputs":1,"noerr":0,"x":287.06591796875,"y":649.232666015625,"wires":[["c7ea8d98.aa09","4bc373dd.21689c"]]},{"id":"bd65858d.3a0778","type":"service-dialog","z":"dbff05bd.4b4958","name":"set clock","mode":"startconverse","dialog":"","clientid":"","converse":"","x":656,"y":554,"wires":[["7b4f6386.ac988c"]]},{"id":"c7ea8d98.aa09","type":"debug","z":"dbff05bd.4b4958","name":"","active":false,"console":"false","complete":"false","x":353.0035095214844,"y":722.6770629882812,"wires":[]},{"id":"4bc373dd.21689c","type":"service-dialog","z":"dbff05bd.4b4958","name":"continue clock","mode":"converse","dialog":"5baf5625-5acc-4a60-ba98-64bbc917dec9","clientid":"","converse":"","x":471,"y":647,"wires":[["66b45465.1f549c","b94fd698.f5ab48"]]},{"id":"7b4f6386.ac988c","type":"function","z":"dbff05bd.4b4958","name":"","func":"context.global.http_conversation_id=msg.dialog.conversation_id;\ncontext.global.http_client_id=msg.dialog.client_id;\n//msg.payload=context.global.conversation_id;\ncontext.global.phone_dialog_switch=true;\nmsg.payload = msg.dialog.response[0];\nmsg.format=\"string\";\nreturn msg;\n","outputs":1,"noerr":0,"x":865.9998779296875,"y":554.0000610351562,"wires":[["aba6b478.a1ee18","33efbb64.3320a4"]]},{"id":"66b45465.1f549c","type":"function","z":"dbff05bd.4b4958","name":"","func":"if(msg.dialog.response.length>0&&context.global.phone_dialog_switch===true){\nmsg.payload=msg.dialog.response.toString();\nmsg.format=\"string\";\nreturn msg;\n}","outputs":1,"noerr":0,"x":685.3988647460938,"y":648.232666015625,"wires":[["76dad377.c2f78c","33efbb64.3320a4"]]},{"id":"b94fd698.f5ab48","type":"debug","z":"dbff05bd.4b4958","name":"","active":false,"console":"false","complete":"dialog.response","x":556,"y":792,"wires":[]},{"id":"aba6b478.a1ee18","type":"debug","z":"dbff05bd.4b4958","name":"","active":false,"console":"false","complete":"true","x":1049.0069580078125,"y":554.666748046875,"wires":[]},{"id":"33efbb64.3320a4","type":"ibmiot out","z":"dbff05bd.4b4958","authentication":"boundService","apiKey":"","outputType":"cmd","deviceId":"Sherry","deviceType":"robot","eventCommandType":"ch_tts_output","format":"string","data":"msg.payload","name":"IBM IoT","service":"registered","x":1027,"y":366,"wires":[]},{"id":"76dad377.c2f78c","type":"debug","z":"dbff05bd.4b4958","name":"","active":false,"console":"false","complete":"false","x":765.0000305175781,"y":736.670166015625,"wires":[]}]
    </body>